{% extends "base.html" %}

{% block title %}Scan Tool - Lab Fabrikasi{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Header with Step Indicator -->
    <div class="text-center mb-6">
        <h1 class="text-3xl font-bold text-primary-900 mb-1">Peminjaman & Pengembalian Alat</h1>
        <p class="text-base text-primary-700 mb-6">Scan <span class="font-bold">KTM</span> dan tag alat untuk
            meminjam/mengembalikan</p>

        <!-- Step Progress Indicator -->
        <div class="flex items-center justify-center space-x-3 max-w-2xl mx-auto">
            <div id="step-1"
                class="step-indicator active flex-1 text-center py-3 rounded-xl bg-gradient-to-r from-blue-500 to-blue-600 text-white font-semibold text-sm shadow-md">
                1. Scan KTM
            </div>
            <svg class="w-5 h-5 text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
            <div id="step-2"
                class="step-indicator flex-1 text-center py-3 rounded-xl bg-primary-100 text-primary-600 font-semibold text-sm">
                2. Scan Tag
            </div>
            <svg class="w-5 h-5 text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
            <div id="step-3"
                class="step-indicator flex-1 text-center py-3 rounded-xl bg-primary-100 text-primary-600 font-semibold text-sm">
                3. Konfirmasi
            </div>
        </div>
    </div>

    <!-- Two Column Layout - 5:3 Ratio -->
    <div class="grid grid-cols-1 lg:grid-cols-8 gap-6">
        <!-- Left Column: Transaction Data (5/8) -->
        <div class="lg:col-span-5">
            <div class="bg-white rounded-2xl shadow-lg p-6 border border-primary-100">
                <h3 class="text-xl font-bold text-primary-900 mb-5">Data Transaksi</h3>

                <!-- Student Info (No Photo) -->
                <div id="student-info"
                    class="mb-5 p-5 bg-gradient-to-br from-primary-50 to-primary-100 rounded-xl border border-primary-200 hidden">
                    <p class="text-xs text-primary-700 mb-2 font-medium">Mahasiswa:</p>
                    <div>
                        <p id="student-name-main" class="text-2xl font-bold text-primary-900">-</p>
                        <p id="student-nim-main" class="text-base text-primary-700 font-medium mt-1">NIM: -</p>
                        <p id="student-email-main" class="text-sm text-primary-600 mt-1">-</p>
                    </div>
                </div>

                <!-- Tool Info -->
                <div id="tool-info"
                    class="mb-5 p-5 bg-gradient-to-br from-primary-50 to-primary-100 rounded-xl border border-primary-200 hidden">
                    <p class="text-xs text-primary-700 mb-2 font-medium">Alat:</p>
                    <div>
                        <p id="tool-name" class="text-2xl font-bold text-primary-900">-</p>
                        <p id="tool-category" class="text-base text-primary-700 font-medium mt-1">Kategori: -</p>
                        <div id="tool-status-badge" class="mt-3">
                            <span
                                class="px-4 py-2 rounded-full text-sm font-semibold bg-primary-200 text-primary-800">-</span>
                        </div>
                    </div>
                </div>

                <!-- Action Button -->
                <div id="action-container" class="hidden">
                    <button id="confirm-btn"
                        class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold py-5 px-8 rounded-xl text-xl shadow-lg transition-all transform hover:scale-[1.02]">
                        Confirm Pinjam
                    </button>
                </div>

                <!-- Buttons: Back + Reset -->
                <div class="mt-5 flex items-center space-x-3">
                    <a href="{{ url_for('index') }}"
                        class="flex-1 bg-white hover:bg-primary-50 text-primary-700 border-2 border-primary-300 hover:border-primary-500 font-bold py-4 px-6 rounded-xl text-base text-center shadow-lg transition-all">
                        Kembali
                    </a>
                    <button id="reset-btn"
                        class="bg-white hover:bg-primary-50 text-primary-700 border-2 border-primary-300 hover:border-primary-500 font-semibold px-4 py-4 rounded-xl transition-all text-sm">
                        Reset
                    </button>
                </div>
            </div>
        </div>

        <!-- Right Column: RFID Scanners (3/8) -->
        <div class="lg:col-span-3 space-y-5">
            <!-- Student Card Scanner -->
            <div class="bg-white rounded-2xl shadow-lg p-5 sticky top-4 border border-primary-100">
                <h3 class="text-lg font-bold text-primary-900 mb-4 flex items-center space-x-2">
                    <svg class="w-6 h-6 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                    <span>Scan KTM</span>
                </h3>

                <!-- Waiting State (icon + text) -->
                <div id="student-scanner-waiting"
                    class="border-4 border-primary-200 rounded-2xl p-6 text-center transition-all duration-300 bg-primary-50/30">
                    <svg class="mx-auto h-20 w-20 text-primary-400" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                    <p class="text-base font-semibold text-primary-700 mt-3">Menunggu kartu...</p>
                </div>

                <!-- Scanned State (photo only) -->
                <div id="student-scanner-scanned" class="hidden">
                    <div
                        class="border-4 border-blue-400 rounded-2xl p-4 text-center bg-gradient-to-br from-blue-50 to-white">
                        <img id="student-photo"
                            class="mx-auto h-40 w-40 rounded-2xl object-cover border-4 border-white shadow-lg"
                            src="{{ url_for('static', filename='assets/placeholder_profile.png') }}"
                            alt="Student Photo">
                    </div>
                </div>
            </div>

            <!-- Tool Scanner (appears after student scan) -->
            <div id="tool-scanner-container"
                class="bg-white rounded-2xl shadow-lg p-5 border border-primary-100 hidden">
                <h3 class="text-lg font-bold text-primary-900 mb-4 flex items-center space-x-2">
                    <svg class="w-6 h-6 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                    </svg>
                    <span>Scan Tag Alat</span>
                </h3>

                <!-- Waiting State -->
                <div id="tool-scanner-waiting"
                    class="border-4 border-primary-200 rounded-2xl p-6 text-center transition-all duration-300 bg-primary-50/30">
                    <svg class="mx-auto h-20 w-20 text-primary-400" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                    </svg>
                    <p class="text-base font-semibold text-primary-700 mt-3">Menunggu tag alat...</p>
                </div>

                <!-- Scanned State (for future: will show tool photo if available) -->
                <div id="tool-scanner-scanned" class="hidden">
                    <div
                        class="border-4 border-blue-400 rounded-2xl p-6 text-center bg-gradient-to-br from-blue-50 to-white">
                        <svg class="mx-auto h-20 w-20 text-blue-600" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p class="text-base font-semibold text-blue-700 mt-3">Tag terdeteksi!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/scan.js') }}"></script>
{% endblock %}